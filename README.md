[![Build Status](https://travis-ci.org/thibaultduponchelle/messy-perl-ci-workflows.svg?branch=master)](https://travis-ci.org/thibaultduponchelle/messy-perl-ci-workflows) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/linux-check-syntax/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/linux-github-action-install-with-cpanminus/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/linux-github-action-install-with-cpm/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/linux-perl-container-cpm/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/linux-with-perl-setup-and-cpm/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/macos-cpm/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/macos-perl-container-cpm/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/macos-share-cpanminus/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/macos-share-cpm/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/macos-system-cpanminus/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/macos-system-cpm/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/nightly-build/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/perl-critic/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/plack/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/windows-cpanminus/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/windows-cpm/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/xml-libxml/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/webframeworks/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/templating/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/mess/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Action Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/perl-5.6.2-on-recent-ubuntu/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Action Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/perl-5.8.9-on-recent-ubuntu/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Action Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/perl-5.10.1-on-recent-ubuntu/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/alien-almost-all-1/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/alien-almost-all-2/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/alien-almost-all-3/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/alien-almost-all-4/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/alien-almost-all-5/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/alien-almost-all-6-problem-childs/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/alien-river-only-1/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/alien-river-only-2/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/alien-river-only-3/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/alien-river-only-4/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/alien-river-only-5-problem-childs/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/multiple-runs-of-cpm/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/multiple-runs-of-cpm-global/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/problem-childs/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/spatialite/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 
[![Actions Status](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/workflows/sodium/badge.svg)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/actions) 


# Messy Perl github ci workflows

## General

This is a repository to give some inspiration to my Perl fellow developers.

It can be also for some testing.

## Travis

### Mandatory kit 

Please note that your repository needs to include a `Build.PL`, a `Makefile.PL` or a `makefile` (with a `test` target).

Check the documentation about [Travis Perl helper](https://docs.travis-ci.com/user/languages/perl)

### Activation

You also need to activate `Travis CI` for your repository (connect to travis website with github credentials).

### Extra bits

If your Perl version gets removed suddenly, it's probably because you are attached to a *floating* platform and the *latest* changed from one Ubuntu LTS to another Ubuntu LTS (for instance).

You can fix it by forcing the platform.

## Azur pipelines

Check this [house absolute blog post](https://blog.urth.org/2019/11/18/my-new-ci-helpers-for-perl/)

### Helpers 

See [houseabsolute ci helpers](https://github.com/houseabsolute/ci-perl-helpers) 


## Github actions workflows

### Ready to use github actions

- [Install with cpm](https://github.com/marketplace/actions/install-with-cpanm) ([github repo](https://github.com/perl-actions/install-with-cpm))
- [Install with cpanm](https://github.com/marketplace/actions/install-with-cpanm) ([github repo](https://github.com/perl-actions/install-with-cpanm))
- [Setup Perl Environment](https://github.com/marketplace/actions/setup-perl-environment) ([github repo](https://github.com/shogo82148/actions-setup-perl))
- [Perl Critic](https://github.com/marketplace/actions/github-action-for-perl-critic) ([github repo](https://github.com/Difegue/action-perlcritic))

### Limits 

There is a limit in how much github actions you can run on private repositories.
It's a matter of storage and run duration. The duration depends the platform (linux is cheap, windows is less, and macos is very expensive).

![ghactionslimits](ghactionslimits.png)

### Containers limitation

You can only launch containers from a GNU/Linux host.
For instance, if you specify `run-on: macOS-latest`, you won't be able to use `container:` :


```
    # THIS CODE DOES NOT WORK

    runs-on: macOS-latest

    strategy:
      matrix:
        perl-version:
          - 'latest'

    container:
      image: perl:${{ matrix.perl-version }}
```

Will produce :

```
    ##[error]Container operations are only supported on Linux runners`
``` 

See for instance this [failed run](https://github.com/thibaultduponchelle/messy-perl-github-actions/runs/608005097?check_suite_focus=true)

### Examples 

#### Create perl docker images
- [build perl blead and push to docker hub](https://github.com/thibaultduponchelle/docker-perl-blead/blob/master/.github/workflows/perl-blead.yml)

#### Install or test modules
- [perl critic](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/blob/master/.github/workflows/perl-critic.yml)
- [windows and cpanm (do not use helper action for it)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/blob/master/.github/workflows/windows-cpanminus.yml)
- [windows and cpm (do not use helper action for it)](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/blob/master/.github/workflows/windows-cpm.yml)
- [build alien with cpanminus on macos](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/blob/master/.github/workflows/macos-share-cpanminus.yml)
- [build alien with cpm on macos](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/blob/master/.github/workflows/macos-share-cpm.yml)

#### Use perl containers 
- [matrix + perl containers](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/blob/master/.github/workflows/linux-perl-container-cpm.yml)
- [use houseabsolute container](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/blob/master/.github/workflows/houseabsolute.yml)
- [use official docker image 5.30.2](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/blob/master/.github/workflows/official-docker.yml)
- [use perl blead](https://github.com/thibaultduponchelle/messy-perl-ci-workflows/blob/master/.github/workflows/perl-blead.yml)


## Notes 

### Check syntax

Executing `perl -c` on file could actually run them partially (`BEGIN` blocks...).

## Resources

- [Skaji blog post about github actions for Perl](https://medium.com/@skaji/perl-meets-github-actions-3893ae100205) [skaji github ci samples](https://github.com/skaji/perl-github-actions-sample)

